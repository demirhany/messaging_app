<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div th:insert="components/header :: header"></div>
<div class="container-fluid">
    <div class="row mt-3">
        <div class="col-6">
            <div class="members" id="members_list">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Username</th>
                        <th>Send Message</th>
                    </tr>
                    </thead>
                    <tbody id="users_list"></tbody>
                </table>
            </div>
        </div>
        <div class="col-6" id="message_form_parent"></div>
    </div>
</div>
</body>
<script>
    function getUsers() {
        let users_list_element = document.getElementById("users_list");
        let userOwnNick = localStorage.getItem("nick");
        fetch("/api/user/users", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                } else {
                    return response.json();
                }
            })
            .then(data => {
                data.forEach(user => {
                    if (user.nick === userOwnNick) {
                        console.log("user nick equals your own nick.");
                    } else {
                        let row = document.createElement("tr");
                        row.innerHTML = `
                        <td>${user.nick}</td>
                        <td>
                            <button class="btn btn-primary" onclick="openMessageForm('${user.nick}')">Send Message to ${user.nick}</button>
                        </td>
                    `;
                        users_list_element.appendChild(row);
                    }
                });
                // Handle the JSON data here
                console.log(data);
            })
            .catch(error => {
                console.error(error);
            });
    }

    getUsers();
</script>
</html>